var n=Object.prototype.toString;function e(e){if(null==e)return"undefined";var r=n.call(e).slice(8,-1).toLowerCase();switch(r){case"string":case"number":case"boolean":case"array":case"symbol":case"function":return r;default:return"object"}}var r={enabled:[!0,!1],error:[!0,!1],interval:[1e3,1e3],tolerance:[3,3]};function t(n){var e={};for(var t in r)e[t]=r[t][n];return e}function o(){return t(0)}function c(){var n;try{n="production"===process.env.NODE_ENV?o():t(1)}catch(e){n=o()}if(!n.enabled)return null;var e,r=[],c=100,a=new Array(100).fill(0);return setTimeout((function(){return e=setInterval((function(){return function(){if(r.length>=c)return void clearInterval(e);if(r.forEach((function(n,e){0!==n[0]||1===n[1]?a[e]=0:a[e]++})),a.some((function(e){return e>=n.tolerance}))){var t="\n        You maybe forget to call 'notify' in 'process' function.\n        It's maybe make bad effect for your 'hook for dispatch',\n        or source is 'sequence', yet.\n      ";if(r.length=c,n.error)throw new Error(t);console.warn(t)}}()}),n.interval)}),500),{collect:function(n,e){r[n]||(r[n]=[]),r[n][e]=e}}}var a=[["before",0],[0,0],["0",0],["after",1],[1,1],["1",1],["create",2],["2",2],[2,2],["3",3],[3,3],["interrupt",3]];function i(n){var r=function(n){var e=a.filter((function(e){return e[0]===n})).map((function(n){return n[1]}));if(1===e.length)return e[0]}(n);if("undefined"===e(r))throw new Error('\n      Invalid tag, expected:\n      "before", "0", 0, "after", "1", 1, "create", "2", 2, "interrupt", "3", 3.\n      Instead, received: '.concat(n,"\n    "));return r}function u(n){return n.reduce((function(n,e){return n.concat(e)}),[])}var f={system:0,observer:1,user:2},s={observer:0,user:1,system:2},d={system:0,observer:1,user:2},h={observer:0,user:1,system:2};function l(n,r){if("function"!==e(n))throw new Error("Expected the process as a function. Instead, received: ".concat(e(n)));var t=c(),o=!1,a=[];function l(n){return!!a.find((function(e){return e[0]===n}))}var p=[[],[],[],[]];var v=[];function y(n,e,r){if(!l(n))return v.push({type:n,tag:e,fn:r}),n;var t=i(e),o=a.find((function(e){return e[0]===n})),c=0;switch(t){case 0:c=f.user;break;case 1:c=s.user;break;case 2:c=d.user;break;case 3:c=h.user}return o[1].hook(e,(function(e,o){var c=1===t;(2===t||3==t)&&e===n?r(n):0===t?r(e):c?r(e,o):console.warn("Unknown index: ".concat(t,", this means unknown hook."))}),c),n}function w(n){if(l(n)){var e=v.findIndex((function(e){return e.type===n}));if(!(e<0)){var r=v.splice(e,1)[0],t=r.tag,o=r.fn;y(n,t,o),w(n)}}}var b=0;function k(c){if("string"!==e(c)||!c)throw new Error("\n        Expected the type as a string and not empty.\n        Instead, type received:".concat(e(c),", value received:").concat(c,"\n      "));if(!l(c)){var v=function(n,r,t){for(var o=[[],[],[],[]],c=n,a=!1,f=!1,s=1;s<=r;s++)o.forEach((function(n){return n.push([])}));function d(){return!f||(f=!1,a=!1,!1)}var h={hook:function(n,r,t){var c=i(n);if("function"!==e(r))throw new Error("\n        Expected the fn as a function. Instead, received: ".concat(e(r),".\n      "));o[c][t].push(r)},interrupt:function(){a?(f=!0,u(o[3]).forEach((function(n){return n(c)}))):console.warn("State Machine can be interrupted only after working or before ended.")},startWork:function(n){if(d(),a)throw new Error("SM named ".concat(c," has started work!"));u(o[0]).forEach((function(e){return e(n)})),a=!0},endWork:function(n,e){if(d()){if(!a)throw new Error("SM named ".concat(c," has ended work!"));a=!1,u(o[1]).forEach((function(r){return r(n,e)}))}}};return t(h),u(o[2]).forEach((function(n){return n(c)})),h}(c,3,(function(n){p[2].forEach((function(e){return n.hook("create",e,d.observer)})),a.push([c,n,k]),w(c)})),y=b++;return v.hook("before",(function(){o=!0,t&&t.collect(y,0),r&&(o=!1)}),f.system),p[0].forEach((function(n){return v.hook("before",n,f.observer)})),v.hook("after",(function(){t&&t.collect(y,1),r||(o=!1)}),f.system),p[1].forEach((function(n){return v.hook("after",n,s.observer)})),v.hook("interrupt",(function(n){console.log("Action named '".concat(n,"' is interrupted before worked completely.")),t&&t.collect(y,1),o=!1}),h.system),p[3].forEach((function(n){return v.hook("interrupt",n,h.observer)})),k}function k(e){if(!r&&o)throw new Error("\n          Can't dispatch action while sequence source is being processed,\n          if 'discrete dispatch' is expected, pass 'true' to parameter\n          called 'discrete' of 'createSource'.\n          The current type is ".concat(c,".\n        "));var t={type:c,payload:e};v.startWork(t),n(t,(function(n){return v.endWork(n,t)}))}console.warn("The type has existed: ".concat(c))}return{observe:function(n,r,t){if("function"!==e(r)||"undefined"===e(n)||"undefined"!==e(t))return y(n,r,t);!function(n,e){var r=i(n);p[r].push(e)}(n,r)},isDiscrete:function(){return!!r},isWaiting:function(){return o},hasType:l,dispatch:function(n){var e;return(e=l(n.type)?function(n){var e=a.find((function(e){return e[0]===n}));if(e)return e[2]}(n.type):k(n.type))(n.payload),e},interrupt:function(n){var e=a.find((function(e){return e[0]===n}));e?e[1].interrupt():console.warn("Doesn't exist the type named ".concat(n,"."))},createDispatch:k,createDispatches:function(){for(var n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return e.map((function(n){return k(n)}))}}}export{l as createSource};
