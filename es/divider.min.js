function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==t)return;var r,o,c=[],i=!0,a=!1;try{for(t=t.call(e);!(i=(r=t.next()).done)&&(c.push(r.value),!n||c.length!==n);i=!0);}catch(e){a=!0,o=e}finally{try{i||null==t.return||t.return()}finally{if(a)throw o}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var t=Object.prototype.toString;function r(e){if(null==e)return"undefined";var n=t.call(e).slice(8,-1).toLowerCase();switch(n){case"string":case"number":case"boolean":case"array":case"symbol":case"function":return n;default:return"object"}}function o(e){return"array"!==r(e)?[]:e.filter((function(e){return!!e}))}var c={enabled:[!0,!1],error:[!0,!1],interval:[1e3,1e3],tolerance:[3,3]};function i(e){var n={};for(var t in c)n[t]=c[t][e];return n}function a(){return i(0)}function u(){var e;try{e="production"===process.env.NODE_ENV?a():i(1)}catch(n){e=a()}if(!e.enabled)return null;var n,t=[],r=100,o=new Array(100).fill(0);function c(){t.length=100}return setTimeout((function(){return n=setInterval((function(){return function(){if(t.length>=r)return void clearInterval(n);if(t.forEach((function(e,n){0!==e[0]||1===e[1]?o[n]=0:o[n]++})),o.some((function(n){return n>=e.tolerance}))&&t.length<r){var i="\n        You maybe forget to call 'notify' in 'process' function.\n        It's maybe make bad effect for your 'hook for dispatch',\n        or source is 'sequence', yet.\n      ";if(c(),e.error)throw new Error(i);console.warn(i)}}()}),e.interval)}),500),{collect:function(e,n){t[e]||(t[e]=[]),t[e][n]=n},destroy:c}}var f=[["before",0],[0,0],["0",0],["after",1],[1,1],["1",1],["interrupt",2],["2",2],[2,2]];function s(e){var n=function(e){var n=f.filter((function(n){return n[0]===e})).map((function(e){return e[1]}));if(1===n.length)return n[0]}(e);if("undefined"===r(n))throw new Error('\n      Invalid tag, expected:\n      "before", "0", 0, "after", "1", 1, "interrupt", "2", 2.\n      Instead, received: '.concat(e,"\n    "));return n}function l(e){return e.reduce((function(e,n){return e.concat(n)}),[])}var h={system:0,observer:1,user:2},d={observer:0,user:1,system:2},p={observer:0,user:1,system:2};function v(n,t){if("function"!==r(n))throw new Error("Expected the process as a function. Instead, received: ".concat(r(n)));var c=u(),i=!1,a=[];function f(e){return a.find((function(n){return n[0]===e}))}function v(e){return!!f(e)}var y=[[],[],[]],b=[[],[],[]],m=0;var w=0;function g(e){if("string"!==r(e)||!e)throw new Error("\n        Expected the type as a string and not empty.\n        Instead, type received:".concat(r(e),", value received:").concat(e,"\n      "));var u=m;if(!v(e)){var g,k=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=[[[],[],[]],[[],[],[]],[[],[],[]]],c=e,i=0;function a(e,n,o){var c=i,a=s(e);if("function"!==r(n))throw new Error("Expected the fn as a function. Instead, received: ".concat(r(n),"."));var u=t[a][o].length;t[a][o][u]=n;var f=!1;return function(){!f&&c===i&&t[a][o].length>=u&&(f=!0,t[a][o][u]=null)}}var u=1;function f(){var e,i=u++,a=!1;return{startWork:function(n){if(!a){if(e)throw new Error("SM named ".concat(c," has started work!"));o(l(t[0])).forEach((function(e){return e(n)})),e=!0}},endWork:function(n,r){if(!a){if(!e)throw new Error("SM named ".concat(c," has ended work!"));e=!1,o(l(t[1])).forEach((function(e){return e(n,r)}))}},interrupt:function(){if(a&&n)console.log("No impact of this interruption, because state machine named ".concat(c," has interrupted, the uid: ").concat(i,"."));else{if(!e&&n)return"undefined"===r(e)?void console.log("No impact of this interruption, because state machine has not worked, the uid: ".concat(i,".")):"boolean"===r(e)?void console.log("No impact of this interruption, because state machine has worked, the uid: ".concat(i,".")):void console.log("State Machine can be interrupted only after working or before ended, the uid: ".concat(i,"."));a=!0,e=!1,o(l(t[2])).forEach((function(e){return e(c)})),n&&(console.log("State Machine named ".concat(c," is interrupted, the uid: ").concat(i,".")),console.log("---------------"))}}}}function h(){i++,t=[[[],[],[]],[[],[],[]],[[],[],[]]]}return{hook:a,reset:h,createWorkUnit:f}}(e),E=w++;return k.hook("before",(function(){i=!0,c&&c.collect(E,0),t&&(i=!1)}),h.system),o(y[0]).forEach((function(n,t){return b[0][t][e]=k.hook("before",n,h.observer)})),k.hook("after",(function(){c&&c.collect(E,1),t||(i=!1)}),h.system),o(y[1]).forEach((function(n,t){return b[1][t][e]=k.hook("after",n,d.observer)})),k.hook("interrupt",(function(){c&&c.collect(E,1),i=!1}),p.system),o(y[2]).forEach((function(n,t){return b[2][t][e]=k.hook("interrupt",n,p.observer)})),function(e,n,t){a.push([e,n,t])}(e,k,I),I}function I(r){if(u===m){if(!t&&i)throw new Error("\n          Can't dispatch action while sequence source is being processed,\n          if 'discrete dispatch' is expected, pass 'true' to parameter\n          called 'discrete' of 'createSource'.\n          The current type is ".concat(e,".\n        "));g&&t&&g.interrupt();var o=k.createWorkUnit();g=o;var c={type:e,payload:r},a=f(e);a&&(a[3]=o.interrupt),o.startWork(c),n(c,(function(e){return o.endWork(e,c)}))}else console.log("Invalid dispatch, because the source has reseted, the type is ".concat(e))}console.warn("The dispatch of type has existed: ".concat(e))}return{observe:function(n,t,o){return"function"===r(t)&&"undefined"!==r(n)&&"undefined"===r(o)?function(n,t){var r=m,o=s(n),c=y[o].length;y[o][c]=t,b[o][c]={};var i=!1;return function(){if(!i&&r===m&&b[o].length>=c){for(var n=0,t=Object.entries(b[o][c]);n<t.length;n++){(0,e(t[n],2)[1])()}y[o][c]=null}}}(n,t):function(e,n,t){if(!v(e))return void console.warn("Cant't observe action before created, the action's type is ".concat(e,"."));var r=s(n),o=a.find((function(n){return n[0]===e})),c=0;switch(r){case 0:c=h.user;break;case 1:c=d.user;break;case 2:c=p.user}return o[1].hook(n,(function(n,o){var c=0===r,i=1===r;2==r&&n===e?t(e):c?t(n):i?t(n,o):console.warn("Unknown index: ".concat(r,", this means unknown hook."))}),c)}(n,t,o)},isDiscrete:function(){return!!t},isWaiting:function(){return i},reset:function(){a.forEach((function(e){"function"===r(e[3])&&e[3](),e[1].reset()})),a=[],c&&c.destroy(),c=u(),y=[[],[],[]],b=[[],[],[]],i=!1,m++},hasType:v,dispatch:function(e){var n;return(n=v(e.type)?function(e){var n=f(e);if(n)return n[2]}(e.type):g(e.type))(e.payload),n},interrupt:function(e){var n=f(e);n?n[3]():console.warn("Doesn't exist the type named ".concat(e,". can't interrupt"))},createDispatch:g,createDispatches:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.map((function(e){return g(e)}))}}}export{v as createSource};
