"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=Object.prototype.toString;function e(e){if(null==e)return"undefined";var r=n.call(e).slice(8,-1).toLowerCase();switch(r){case"string":case"number":case"boolean":case"array":case"symbol":case"function":return r;default:return"object"}}var r={enabled:[!0,!1],error:[!0,!1],interval:[1e3,1e3],tolerance:[3,3]};function t(n){var e={};for(var t in r)e[t]=r[t][n];return e}function o(){return t(0)}function c(){var n;try{n="production"===process.env.NODE_ENV?o():t(1)}catch(e){n=o()}if(!n.enabled)return null;var e,r=[],c=100,i=new Array(100).fill(0);return setTimeout((function(){return e=setInterval((function(){return function(){if(r.length>=c)return void clearInterval(e);if(r.forEach((function(n,e){0!==n[0]||1===n[1]?i[e]=0:i[e]++})),i.some((function(e){return e>=n.tolerance}))){var t="\n        You maybe forget to call 'notify' in 'process' function.\n        It's maybe make bad effect for your 'hook for dispatch',\n        or source is 'sequence', yet.\n      ";if(r.length=c,n.error)throw new Error(t);console.warn(t)}}()}),n.interval)}),500),{collect:function(n,e){r[n]||(r[n]=[]),r[n][e]=e}}}var i=[["before",0],[0,0],["0",0],["after",1],[1,1],["1",1],["create",2],["2",2],[2,2]];function u(n){var r=function(n){var e=i.filter((function(e){return e[0]===n})).map((function(n){return n[1]}));if(1===e.length)return e[0]}(n);if("undefined"===e(r))throw new Error('\n      Invalid tag.Expected: "before", "0", 0, "after", "1", 1, "create", "2", 2. Instead, received: '.concat(n,"\n    "));return r}function a(n){return n.reduce((function(n,e){return n.concat(e)}),[])}exports.createSource=function(n,r){if("function"!==e(n))throw new Error("Expected the process as a function. Instead, received: ".concat(e(n)));var t=c(),o=!1,i=[];function f(n){return!!i.find((function(e){return e[0]===n}))}var s=[[],[],[]],d=[];function h(n,e,r){if(!f(n))return d.push({type:n,tag:e,fn:r}),n;var t=u(e),o=i.find((function(e){return e[0]===n})),c=0===t,a=2===t;return o[1].hook(e,(function(e,t){a&&e===n?r(n):(c&&(t=e),t.type===n&&(c?r(t):r(e,t)))}),a?1:c?2:1),n}function l(n){if(f(n)){var e=d.findIndex((function(e){return e.type===n}));if(!(e<0)){var r=d.splice(e,1)[0],t=r.tag,o=r.fn;h(n,t,o),l(n)}}}var p=0;function v(c){if("string"!==e(c)||!c)throw new Error("\n        Expected the type as a string and not empty.\n        Instead, type received".concat(e(c),", value received:").concat(c,"\n      "));if(i.find((function(n){return n[0]===c})))throw new Error("The type has existed: ".concat(c));var f=function(n,r,t){for(var o=[[],[],[]],c=n,i=!1,f=1;f<=r;f++)o[0].push([]),o[1].push([]),o[2].push([]);var s={hook:function(n,r,t){var c=u(n);if("function"!==e(r))throw new Error("\n        Expected the fn as a function. Instead, received: ".concat(e(r),".\n      "));o[c][t].push(r)},startWork:function(n){if(i)throw new Error("SM named ".concat(c," has started work!"));i=!0,a(o[0]).forEach((function(e){return e(n)}))},endWork:function(n,e){if(!i)throw new Error("SM named ".concat(c," has ended work!"));i=!1,a(o[1]).forEach((function(r){return r(n,e)}))}};return t(s),a(o[2]).forEach((function(n){return n(c)})),s}(c,3,(function(n){s[2].forEach((function(e){return n.hook("create",e,0)})),i.push([c,n]),l(c)})),d=p++;f.hook("after",(function(){t&&t.collect(d,1),r||(o=!1)}),2),s[1].forEach((function(n){return f.hook("after",n,0)}));return f.hook("before",(function(){o=!0,t&&t.collect(d,0),r&&(o=!1)}),0),s[0].forEach((function(n){return f.hook("before",n,1)})),function(e){if(!r&&o)throw new Error("\n          Can't dispatch action while sequence source is being processed,\n          if 'discrete dispatch' is expected, pass 'true' to parameter\n          called 'discrete' of 'createSource'.\n          The current type is ".concat(c,".\n        "));var t={type:c,payload:e};f.startWork(t),n(t,function(n){return function(e){return f.endWork(e,n)}}(t))}}return{observe:function(n,r,t){if("function"!==e(r)||"undefined"===e(n)||"undefined"!==e(t))return h(n,r,t);!function(n,e){var r=u(n);s[r].push(e)}(n,r)},isDiscrete:function(){return!!r},isWaiting:function(){return o},hasType:f,createDispatch:v,createDispatches:function(){for(var n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return e.map((function(n){return v(n)}))}}};
