"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.prototype.toString;function n(n){if(null==n)return"undefined";var t=e.call(n).slice(8,-1).toLowerCase();switch(t){case"string":case"number":case"boolean":case"array":case"symbol":case"function":return t;default:return"object"}}var t={enabled:[!0,!1],error:[!0,!1],interval:[1e3,1e3],tolerance:[3,3]};function r(e){var n={};for(var r in t)n[r]=t[r][e];return n}function o(){return r(0)}function c(){var e;try{e="production"===process.env.NODE_ENV?o():r(1)}catch(n){e=o()}if(!e.enabled)return null;var n,t=[],c=100,i=new Array(100).fill(0);function a(){t.length=100}return setTimeout((function(){return n=setInterval((function(){return function(){if(t.length>=c)return void clearInterval(n);if(t.forEach((function(e,n){0!==e[0]||1===e[1]?i[n]=0:i[n]++})),i.some((function(n){return n>=e.tolerance}))&&t.length<c){var r="\n        You maybe forget to call 'notify' in 'process' function.\n        It's maybe make bad effect for your 'hook for dispatch',\n        or source is 'sequence', yet.\n      ";if(a(),e.error)throw new Error(r);console.warn(r)}}()}),e.interval)}),500),{collect:function(e,n){t[e]||(t[e]=[]),t[e][n]=n},destroy:a}}var i=[["before",0],[0,0],["0",0],["after",1],[1,1],["1",1],["interrupt",2],["2",2],[2,2]];function a(e){var t=function(e){var n=i.filter((function(n){return n[0]===e})).map((function(e){return e[1]}));if(1===n.length)return n[0]}(e);if("undefined"===n(t))throw new Error('\n      Invalid tag, expected:\n      "before", "0", 0, "after", "1", 1, "interrupt", "2", 2.\n      Instead, received: '.concat(e,"\n    "));return t}function u(e){return e.reduce((function(e,n){return e.concat(n)}),[])}var s={system:0,observer:1,user:2},f={observer:0,user:1,system:2},d={observer:0,user:1,system:2};exports.createSource=function(e,t){if("function"!==n(e))throw new Error("Expected the process as a function. Instead, received: ".concat(n(e)));var r=c(),o=!1,i=[];function h(e){return i.find((function(n){return n[0]===e}))}function l(e){return!!h(e)}var p=[[],[],[]],v=0;function y(c){if("string"!==n(c)||!c)throw new Error("\n        Expected the type as a string and not empty.\n        Instead, type received:".concat(n(c),", value received:").concat(c,"\n      "));if(!l(c)){var y,w=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=[[[],[],[]],[[],[],[]],[[],[],[]]],o=e;function c(e,t,o){var c=a(e);if("function"!==n(t))throw new Error("\n        Expected the fn as a function. Instead, received: ".concat(n(t),".\n      "));var i=r[c][o].length;r[c][o].push(t);var u=!1;return function(){!u&&r[c][o].length>=i&&(u=!0,r[c][o][i]=function(){})}}var i=1;function s(){var e,c=i++,a=!1;return{startWork:function(n){if(!a){if(e)throw new Error("SM named ".concat(o," has started work!"));u(r[0]).forEach((function(e){return e(n)})),e=!0}},endWork:function(n,t){if(!a){if(!e)throw new Error("SM named ".concat(o," has ended work!"));e=!1,u(r[1]).forEach((function(e){return e(n,t)}))}},interrupt:function(){if(a&&t)console.log("No impact of this interruption, because state machine named ".concat(o," has interrupted, the uid: ").concat(c,"."));else{if(!e&&t)return"undefined"===n(e)?void console.log("No impact of this interruption, because state machine has not worked, the uid: ".concat(c,".")):"boolean"===n(e)?void console.log("No impact of this interruption, because state machine has worked, the uid: ".concat(c,".")):void console.log("State Machine can be interrupted only after working or before ended, the uid: ".concat(c,"."));a=!0,e=!1,u(r[2]).forEach((function(e){return e(o)})),t&&(console.log("State Machine named ".concat(o," is interrupted, the uid: ").concat(c,".")),console.log("---------------"))}}}}function f(){r=[[[],[],[]],[[],[],[]],[[],[],[]]]}return{hook:c,reset:f,createWorkUnit:s}}(c),b=v++;return w.hook("before",(function(){o=!0,r&&r.collect(b,0),t&&(o=!1)}),s.system),p[0].forEach((function(e){return w.hook("before",e,s.observer)})),w.hook("after",(function(){r&&r.collect(b,1),t||(o=!1)}),s.system),p[1].forEach((function(e){return w.hook("after",e,f.observer)})),w.hook("interrupt",(function(){r&&r.collect(b,1),o=!1}),d.system),p[2].forEach((function(e){return w.hook("interrupt",e,d.observer)})),function(e,n,t){i.push([e,n,t])}(c,w,m),m}function m(n){if(!t&&o)throw new Error("\n          Can't dispatch action while sequence source is being processed,\n          if 'discrete dispatch' is expected, pass 'true' to parameter\n          called 'discrete' of 'createSource'.\n          The current type is ".concat(c,".\n        "));y&&y.interrupt();var r=w.createWorkUnit();y=r;var i={type:c,payload:n},a=h(c);a&&(a[3]=r.interrupt),r.startWork(i),e(i,(function(e){return r.endWork(e,i)}))}console.warn("The dispatch of type has existed: ".concat(c))}return{observe:function(e,t,r){return"function"===n(t)&&"undefined"!==n(e)&&"undefined"===n(r)?function(e,n){var t=a(e);p[t].push(n)}(e,t):function(e,n,t){if(!l(e))return void console.warn("Cant't observe action before created, the action's type is ".concat(e,"."));var r=a(n),o=i.find((function(n){return n[0]===e})),c=0;switch(r){case 0:c=s.user;break;case 1:c=f.user;break;case 2:c=d.user}return o[1].hook(n,(function(n,o){var c=0===r,i=1===r;2==r&&n===e?t(e):c?t(n):i?t(n,o):console.warn("Unknown index: ".concat(r,", this means unknown hook."))}),c)}(e,t,r)},isDiscrete:function(){return!!t},isWaiting:function(){return o},reset:function(){i.forEach((function(e){e[3](),e[1].reset()})),i=[],r&&r.destroy(),r=c(),p=[[],[],[]],o=!1},hasType:l,dispatch:function(e){var n;return(n=l(e.type)?function(e){var n=h(e);if(n)return n[2]}(e.type):y(e.type))(e.payload),n},interrupt:function(e){var n=h(e);n?n[3]():console.warn("Doesn't exist the type named ".concat(e,". can't interrupt"))},createDispatch:y,createDispatches:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.map((function(e){return y(e)}))}}};
