"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.prototype.toString;function n(n){if(null==n)return"undefined";var r=e.call(n).slice(8,-1).toLowerCase();switch(r){case"string":case"number":case"boolean":case"array":case"symbol":case"function":return r;default:return"object"}}var r={enabled:[!0,!1],error:[!0,!1],interval:[1e3,1e3],tolerance:[3,3]};function t(e){var n={};for(var t in r)n[t]=r[t][e];return n}function o(){return t(0)}function c(){var e;try{e="production"===process.env.NODE_ENV?o():t(1)}catch(n){e=o()}if(!e.enabled)return null;var n,r=[],c=100,i=new Array(100).fill(0);function u(){r.length=100}return setTimeout((function(){return n=setInterval((function(){return function(){if(r.length>=c)return void clearInterval(n);if(r.forEach((function(e,n){0!==e[0]||1===e[1]?i[n]=0:i[n]++})),i.some((function(n){return n>=e.tolerance}))&&r.length<c){var t="\n        You maybe forget to call 'notify' in 'process' function.\n        It's maybe make bad effect for your 'hook for dispatch',\n        or source is 'sequence', yet.\n      ";if(u(),e.error)throw new Error(t);console.warn(t)}}()}),e.interval)}),500),{collect:function(e,n){r[e]||(r[e]=[]),r[e][n]=n},destroy:u}}var i=[["before",0],[0,0],["0",0],["after",1],[1,1],["1",1],["interrupt",2],["2",2],[2,2]];function u(e){var r=function(e){var n=i.filter((function(n){return n[0]===e})).map((function(e){return e[1]}));if(1===n.length)return n[0]}(e);if("undefined"===n(r))throw new Error('\n      Invalid tag, expected:\n      "before", "0", 0, "after", "1", 1, "interrupt", "2", 2.\n      Instead, received: '.concat(e,"\n    "));return r}function a(e){return e.reduce((function(e,n){return e.concat(n)}),[])}var f={system:0,observer:1,user:2},s={observer:0,user:1,system:2},d={observer:0,user:1,system:2};exports.createSource=function(e,r){if("function"!==n(e))throw new Error("Expected the process as a function. Instead, received: ".concat(n(e)));var t=c(),o=!1,i=[];function h(e){return i.find((function(n){return n[0]===e}))}function l(e){return!!h(e)}var p=[[],[],[]],v=0;function y(c){if("string"!==n(c)||!c)throw new Error("\n        Expected the type as a string and not empty.\n        Instead, type received:".concat(n(c),", value received:").concat(c,"\n      "));if(!l(c)){var h=function(e){var r=[[[],[],[]],[[],[],[]],[[],[],[]]],t=e,o=!1,c=!1;function i(){return!c||(c=!1,o=!1,!1)}return{hook:function(e,t,o){var c=u(e);if("function"!==n(t))throw new Error("\n        Expected the fn as a function. Instead, received: ".concat(n(t),".\n      "));var i=r[c][o].length;r[c][o].push(t);var a=!1;return function(){!a&&r[c][o].length>=i&&(a=!0,r[c][o][i]=function(){})}},reset:function(){o=!1,c=!1,r=[[[],[],[]],[[],[],[]],[[],[],[]]]},interrupt:function(){o?(c=!0,a(r[3]).forEach((function(e){return e(t)}))):console.warn("State Machine can be interrupted only after working or before ended.")},startWork:function(e){if(i(),o)throw new Error("SM named ".concat(t," has started work!"));a(r[0]).forEach((function(n){return n(e)})),o=!0},endWork:function(e,n){if(i()){if(!o)throw new Error("SM named ".concat(t," has ended work!"));o=!1,a(r[1]).forEach((function(r){return r(e,n)}))}}}}(c),y=v++;return h.hook("before",(function(){o=!0,t&&t.collect(y,0),r&&(o=!1)}),f.system),p[0].forEach((function(e){return h.hook("before",e,f.observer)})),h.hook("after",(function(){t&&t.collect(y,1),r||(o=!1)}),f.system),p[1].forEach((function(e){return h.hook("after",e,s.observer)})),h.hook("interrupt",(function(e){console.log("Action named '".concat(e,"' is interrupted before worked completely.")),t&&t.collect(y,1),o=!1}),d.system),p[2].forEach((function(e){return h.hook("interrupt",e,d.observer)})),function(e,n,r){i.push([e,n,r])}(c,h,w),w}function w(n){if(!r&&o)throw new Error("\n          Can't dispatch action while sequence source is being processed,\n          if 'discrete dispatch' is expected, pass 'true' to parameter\n          called 'discrete' of 'createSource'.\n          The current type is ".concat(c,".\n        "));var t={type:c,payload:n};h.startWork(t),e(t,(function(e){return h.endWork(e,t)}))}console.warn("The dispatch of type has existed: ".concat(c))}return{observe:function(e,r,t){return"function"===n(r)&&"undefined"!==n(e)&&"undefined"===n(t)?function(e,n){var r=u(e),t=p[r].length;p[r].push(n);var o=!1;return function(){!o&&p[r].length>=t&&(o=!0,p[r][t]=function(){})}}(e,r):function(e,n,r){if(!l(e))return void console.warn("Cant't observe action before created, the action's type is ".concat(e,"."));var t=u(n),o=i.find((function(n){return n[0]===e})),c=0;switch(t){case 0:c=f.user;break;case 1:c=s.user;break;case 2:c=d.user}return o[1].hook(n,(function(n,o){var c=0===t,i=1===t;2==t&&n===e?r(e):c?r(n):i?r(n,o):console.warn("Unknown index: ".concat(t,", this means unknown hook."))}),c)}(e,r,t)},isDiscrete:function(){return!!r},isWaiting:function(){return o},reset:function(){i.forEach((function(e){return e[1].reset()})),i=[],t&&t.destroy(),t=c(),p=[[],[],[]],o=!1},hasType:l,dispatch:function(e){var n;return(n=l(e.type)?function(e){var n=h(e);if(n)return n[2]}(e.type):y(e.type))(e.payload),n},interrupt:function(e){var n=h(e);n?n[1].interrupt():console.warn("Doesn't exist the type named ".concat(e,". can't interrupt"))},createDispatch:y,createDispatches:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return n.map((function(e){return y(e)}))}}};
