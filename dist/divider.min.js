!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).divider={})}(this,(function(e){"use strict";function n(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function t(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(n){r(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==t)return;var r,o,c=[],i=!0,a=!1;try{for(t=t.call(e);!(i=(r=t.next()).done)&&(c.push(r.value),!n||c.length!==n);i=!0);}catch(e){a=!0,o=e}finally{try{i||null==t.return||t.return()}finally{if(a)throw o}}return c}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return c(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return c(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var i=Object.prototype.toString;function a(e){if(null==e)return"undefined";var n=i.call(e).slice(8,-1).toLowerCase();switch(n){case"string":case"number":case"boolean":case"array":case"symbol":case"function":return n;default:return"object"}}function u(e){return"array"!==a(e)?[]:e.filter((function(e){return!!e}))}var s=Object.prototype.hasOwnProperty;function f(e,n,t){if("object"!==a(e))console.warn("Expected the object as object. Instead, received: ".concat(a(e)));else if(n.some((function(n){return!s.call(e,n)})))throw new Error("Expected the ".concat(t||"obj"," must own keys: ").concat(n.join(" ")))}var d=[["start",0],[0,0],["0",0],["end",1],[1,1],["1",1],["interrupt",2],["2",2],[2,2]];function l(e){var n=function(e){var n=d.filter((function(n){return n[0]===e})).map((function(e){return e[1]}));if(1===n.length)return n[0]}(e);if("undefined"===a(n))throw new Error('\n      Invalid tag, expected:\n      "start", "0", 0, "end", "1", 1, "interrupt", "2", 2.\n      Instead, received: '.concat(e,"\n    "));return n}function h(e){return e.reduce((function(e,n){return e.concat(n)}),[])}function p(e){var n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:console.log,r=[[[],[],[]],[[],[],[]],[[],[],[]]],o=e;function c(e,n,t){var o=l(e);if("function"!==a(n))throw new Error("Expected the fn as a function. Instead, received: ".concat(a(n),"."));var c=r[o][t].length;r[o][t][c]=n;var i=!1;return function(){!i&&r[o][t].length>=c&&(i=!0,r[o][t][c]=null)}}var i=1;function s(){var e,c=i++,s=!1;function f(){return s?(t("No impact of this interruption, because state machine has interrupted, name is ".concat(o,", uid is ").concat(c,".")),void t("Current task's uid is ".concat(c+1))):e?(s=!0,e=!1,u(h(r[2])).forEach((function(e){return e(o)})),t("State Machine named ".concat(o," is interrupted, the uid: ").concat(c,".")),t("Current task's uid is ".concat(c+1)),void t("---------------")):"undefined"===a(e)?(t("No impact of this interruption, because state machine has not worked, name is ".concat(o,", uid is ").concat(c,".")),void t("Current task's uid is ".concat(c+1))):"boolean"===a(e)?(t("No impact of this interruption, because state machine has worked, name is ".concat(o,", uid is ").concat(c,".")),void t("Current task's uid is ".concat(c+1))):(t("State Machine can be interrupted only after working or before ended, name is ".concat(o,", uid is ").concat(c,".")),void t("Current task's uid is ".concat(c+1)))}return n=f,{startWork:function(n){if(!s){if(e)throw new Error("SM named ".concat(o," has started work!"));u(h(r[0])).forEach((function(e){return e(n)})),e=!0}},endWork:function(n,t){if(!s){if(!e)throw new Error("SM named ".concat(o," has ended work!"));e=!1,u(h(r[1])).forEach((function(e){return e(n,t)}))}},interrupt:f}}return{hook:c,createWorkUnit:s,interrupt:function(){"function"===a(n)&&n()}}}function v(e){return e?function(e){return e}:function(e){return console.log(e)}}var y={system:0,observer:1,user:2},w={observer:0,user:1,system:2},b={observer:0,user:1,system:2},m={tip:{statemachine:!1}};function g(e,n){if("function"!==a(e))throw new Error("Expected the processor as function. Instead, received: ".concat(a(e),"."));return!1===e({type:"@dividerjs/built_in_action".concat(Math.random())})||(console.warn("If the processor hasn't matched action, must return false."),n&&console.log("The processor's name is ".concat(n,".")),!1)}e.applyMiddleware=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var c=r.filter((function(e){return"function"===a(e)}));if(r.length>c.length&&console.warn("Each middleware must be a function, the number of non functions is ".concat(r.length-c.length)),0===c.length)return e;var i=!1,u={invalid:{},valid:{}},s=function(n){var t=e.createDispatch(n);return u.invalid[n]=function(){throw new Error("Can't called dispatch when middleware is constructing")},u.valid[n]=t,function(e){return u["".concat(i?"valid":"invalid")][n](e)}},f=s,d=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.map((function(e){return f(e)}))},l={isWaiting:function(){return e.isWaiting()},hasType:function(n){return e.hasType(n)},isDiscrete:function(){return e.isDiscrete()},observe:function(n,t,r){return e.observe(n,t,r)}},h=t({createDispatch:s,_PURE_createDispatch:f,_PURE_createDispatches:d},l),p=null;c.unshift((function(n){var t=n.createDispatch;return function(n){var r=t(n);return e.hasType(n)&&e.replaceDispatch(n,r),r}}));var v=c.reverse().reduce((function(e,n,r){if("function"!==a(e))throw new Error("\n          The middleware ".concat(c.length-r," is invalid,\n          middleware must return a function that decorates 'createDispatch' by it.\n        "));var o=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return t.map((function(n){return e(n)}))},i=n(t(t({},h),{},{createDispatch:e,createDispatches:o}));return p=o,i}),s);return i=!0,t(t({},e),{},{createDispatch:v,createDispatches:p})},e.combineProcessors=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];var r=n.filter((function(e,n){return g(e,"processor".concat(n+1))}));return n.length!==r.length&&console.warn("\n      Processors must be a array of function, the number of non function is ".concat(n.length-r.length,".")),0===r.length?(console.warn("The final processor is 'emtpy', the number of current processors is empty."),console.warn("The final function:"),console.warn("\n      function emptyP(action, notify) {\n        notify(action, action);\n        return true;\n      }\n    "),function(e,n){return n(e,e),!0}):function(e,n){for(var t=0;t<r.length&&!r[t](e,n);t++);}},e.createSource=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m;if("function"!==a(e))throw new Error("Expected the process as a function. Instead, received: ".concat(a(e)));var c=!1,i=[],s=function(e,n,t){return i.push([e,n,t])},d=function(e){return i.find((function(n){return n[0]===e}))},h=function(e){return d(e)?d(e)[2]:null};function g(e){var n=d(e);n?n[1].interrupt():console.warn("Doesn't exist the type named ".concat(e,". can't interrupt"))}var E={isDiscrete:function(){return!!n},isWaiting:function(){return c},hasType:function(e){return!!d(e)}},k=[[],[],[]],j=[[],[],[]];function O(e,n,t){return"function"===a(n)&&"undefined"!==a(e)&&"undefined"===a(t)?D(e,n):x(e,n,t)}function D(e,n){var t=l(e),r=k[t].length;k[t][r]=n,j[t][r]={};return function(){if(j[t].length>=r){for(var e=0,n=Object.entries(j[t][r]);e<n.length;e++){(0,o(n[e],2)[1])()}k[t][r]=null}}}function x(e,n,t){if(E.hasType(e)){var r=l(n),o=d(e),c=0;switch(r){case 0:c=y.user;break;case 1:c=w.user;break;case 2:c=b.user}return o[1].hook(n,(function(n,o){var c=0===r,i=1===r;2==r&&n===e?t(e):c?t(n):i?t(n,o):console.warn("Unknown index: ".concat(r,", this means unknown hook."))}),c)}console.warn("Cant't observe action before created, the action's type is ".concat(e,"."))}var P=v(r.tip.statemachine);function T(t){if("string"!==a(t)||!t)throw new Error("\n        Expected the type as a string and not empty.\n        Instead, type received:".concat(a(t),", value received:").concat(t,"\n      "));if(!E.hasType(t)){var r,o=p(t,P);return o.hook("start",(function(){c=!0,n&&(c=!1)}),y.system),u(k[0]).forEach((function(e,n){return j[0][n][t]=o.hook("start",e,y.observer)})),o.hook("end",(function(){n||(c=!1)}),w.system),u(k[1]).forEach((function(e,n){return j[1][n][t]=o.hook("end",e,w.observer)})),o.hook("interrupt",(function(){return c=!1}),b.system),u(k[2]).forEach((function(e,n){return j[2][n][t]=o.hook("interrupt",e,b.observer)})),s(t,o,i),i}function i(n){if(!E.isDiscrete()&&c)throw new Error("\n          Can't dispatch action while sequence source is being processed,\n          if 'discrete dispatch' is expected, pass 'true' to parameter called 'discrete' of 'createSource'.\n          The current type is ".concat(t,".\n        "));r&&E.isDiscrete()&&r.interrupt();var i=o.createWorkUnit();r=i;var a={type:t,payload:n};i.startWork(a),e(a,(function(e){return i.endWork(e,a)}))}console.warn("The dispatch of type has existed: ".concat(t))}function I(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.map((function(e){return T(e)}))}function S(e){var n;return f(e,["type"],"The action"),(n=E.hasType(e.type)?h(e.type):T(e.type))(e.payload),n}function A(e,n){var t=i.findIndex((function(n){return n[0]===e}));if(t<0)console.warn("Replacement failed, doesn't exist the type: ".concat(e,"."));else{if("function"!==a(n))throw new Error("Expected the dispatch as function. Instead, received: ".concat(a(n)));i[t][2]=n}}return t(t({},E),{},{observe:O,interrupt:g,createDispatch:T,replaceDispatch:A,createDispatches:I,dispatch:S,reset:function(){return console.log("No effect, the 'reset' api has deprecated.")}})},e.decorateProcessor=function(e,n){if("function"!==a(e))throw new Error("Expected the processor as function. Instead, received:".concat(a(e),"."));if("array"!==a(n))throw new Error("Expected the processor as array. Instead, received:".concat(a(e),"."));var t=u(n);return function(n,r){return!!t.includes(null==n?void 0:n.type)&&(e(n,r),!0)}},Object.defineProperty(e,"__esModule",{value:!0})}));
