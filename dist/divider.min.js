!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).divider={})}(this,(function(e){"use strict";function n(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function t(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(n){r(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==t)return;var r,o,c=[],i=!0,a=!1;try{for(t=t.call(e);!(i=(r=t.next()).done)&&(c.push(r.value),!n||c.length!==n);i=!0);}catch(e){a=!0,o=e}finally{try{i||null==t.return||t.return()}finally{if(a)throw o}}return c}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return c(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return c(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var i=Object.prototype.toString;function a(e){if(null==e)return"undefined";var n=i.call(e).slice(8,-1).toLowerCase();switch(n){case"string":case"number":case"boolean":case"array":case"symbol":case"function":return n;default:return"object"}}function u(e){return"array"!==a(e)?[]:e.filter((function(e){return!!e}))}var s=Object.prototype.hasOwnProperty;var f=[["before",0],[0,0],["0",0],["after",1],[1,1],["1",1],["interrupt",2],["2",2],[2,2]];function l(e){var n=function(e){var n=f.filter((function(n){return n[0]===e})).map((function(e){return e[1]}));if(1===n.length)return n[0]}(e);if("undefined"===a(n))throw new Error('\n      Invalid tag, expected:\n      "before", "0", 0, "after", "1", 1, "interrupt", "2", 2.\n      Instead, received: '.concat(e,"\n    "));return n}function d(e){return e.reduce((function(e,n){return e.concat(n)}),[])}var h={system:0,observer:1,user:2},p={observer:0,user:1,system:2},v={observer:0,user:1,system:2};function y(e,n){if("function"!==a(e))throw new Error("Expected the processor as function. Instead, received: ".concat(a(e),"."));return!1===e({type:"@dividerjs/built_in_action".concat(Math.random())})||(console.warn("If the processor hasn't matched action, must return false."),n&&console.log("The processor's name is ".concat(n,".")),!1)}e.applyMiddleware=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var c=r.filter((function(e){return"function"===a(e)}));r.length>c.length&&console.warn("Each middleware must be a function, the number of non functions is ".concat(r.length-c.length));var i=!1,u={invalid:{},valid:{}},s=function(n){var t=e.createDispatch(n);return u.invalid[n]=function(){throw new Error("Can't called dispatch when middleware is constructing")},u.valid[n]=t,function(e){return u["".concat(i?"valid":"invalid")][n](e)}},f={isWaiting:function(){return e.isWaiting()},hasType:function(n){return e.hasType(n)},isDiscrete:function(){return e.isDiscrete()},observe:function(n,t,r){return e.observe(n,t,r)}},l=t({createDispatch:s},f),d=null,h=c.reverse().reduce((function(e,n,r){if("function"!==a(e))throw new Error("\n          The middleware ".concat(c.length-r," is invalid,\n          middleware must return a function that decorates 'createDispatch' by it.\n        "));var o=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return t.map((function(n){return e(n)}))},i=n(t(t({},l),{},{createDispatch:e,createDispatches:o}));return d=o,i}),s);return i=!0,t(t({},e),{},{createDispatch:h,createDispatches:d})},e.combineProcessors=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];var r=n.filter((function(e,n){return y(e,"processor".concat(n+1))}));return n.length!==r.length&&console.warn("\n      Processors must be a array of function, the number of non function is ".concat(n.length-r.length,".")),function(e,n){for(var t=0;t<r.length&&!r[t](e,n);t++);}},e.createSource=function(e,n){if("function"!==a(e))throw new Error("Expected the process as a function. Instead, received: ".concat(a(e)));var r=!1,c=[],i=function(e){return c.find((function(n){return n[0]===e}))},f={isDiscrete:function(){return!!n},isWaiting:function(){return r},hasType:function(e){return!!i(e)}},y=[[],[],[]],b=[[],[],[]];function w(t){if("string"!==a(t)||!t)throw new Error("\n        Expected the type as a string and not empty.\n        Instead, type received:".concat(a(t),", value received:").concat(t,"\n      "));if(!f.hasType(t)){var o,i=function(e){var n,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=[[[],[],[]],[[],[],[]],[[],[],[]]],o=e;function c(e,n,t){var o=l(e);if("function"!==a(n))throw new Error("Expected the fn as a function. Instead, received: ".concat(a(n),"."));var c=r[o][t].length;r[o][t][c]=n;var i=!1;return function(){!i&&r[o][t].length>=c&&(i=!0,r[o][t][c]=null)}}var i=1;function s(){var e,c=i++,s=!1;function f(){if(s&&t)console.log("No impact of this interruption, because state machine named ".concat(o," has interrupted, the uid: ").concat(c,"."));else{if(!e&&t)return"undefined"===a(e)?void console.log("No impact of this interruption, because state machine has not worked, the uid: ".concat(c,".")):"boolean"===a(e)?void console.log("No impact of this interruption, because state machine has worked, the uid: ".concat(c,".")):void console.log("State Machine can be interrupted only after working or before ended, the uid: ".concat(c,"."));s=!0,e=!1,u(d(r[2])).forEach((function(e){return e(o)})),t&&(console.log("State Machine named ".concat(o," is interrupted, the uid: ").concat(c,".")),console.log("---------------"))}}return n=f,{startWork:function(n){if(!s){if(e)throw new Error("SM named ".concat(o," has started work!"));u(d(r[0])).forEach((function(e){return e(n)})),e=!0}},endWork:function(n,t){if(!s){if(!e)throw new Error("SM named ".concat(o," has ended work!"));e=!1,u(d(r[1])).forEach((function(e){return e(n,t)}))}},interrupt:f}}return{hook:c,createWorkUnit:s,interrupt:function(){"function"===a(n)&&n()}}}(t);return i.hook("before",(function(){r=!0,n&&(r=!1)}),h.system),u(y[0]).forEach((function(e,n){return b[0][n][t]=i.hook("before",e,h.observer)})),i.hook("after",(function(){n||(r=!1)}),h.system),u(y[1]).forEach((function(e,n){return b[1][n][t]=i.hook("after",e,p.observer)})),i.hook("interrupt",(function(){return r=!1}),v.system),u(y[2]).forEach((function(e,n){return b[2][n][t]=i.hook("interrupt",e,v.observer)})),function(e,n,t){c.push([e,n,t])}(t,i,s),s}function s(n){if(!f.isDiscrete()&&r)throw new Error("\n          Can't dispatch action while sequence source is being processed,\n          if 'discrete dispatch' is expected, pass 'true' to parameter called 'discrete' of 'createSource'.\n          The current type is ".concat(t,".\n        "));o&&f.isDiscrete()&&o.interrupt();var c=i.createWorkUnit();o=c;var a={type:t,payload:n};c.startWork(a),e(a,(function(e){return c.endWork(e,a)}))}console.warn("The dispatch of type has existed: ".concat(t))}return t(t({},f),{},{observe:function(e,n,t){return"function"===a(n)&&"undefined"!==a(e)&&"undefined"===a(t)?function(e,n){var t=l(e),r=y[t].length;y[t][r]=n,b[t][r]={};var c=!1;return function(){if(!c&&b[t].length>=r){for(var e=0,n=Object.entries(b[t][r]);e<n.length;e++){(0,o(n[e],2)[1])()}y[t][r]=null}}}(e,n):function(e,n,t){if(!f.hasType(e))return void console.warn("Cant't observe action before created, the action's type is ".concat(e,"."));var r=l(n),o=i(e),c=0;switch(r){case 0:c=h.user;break;case 1:c=p.user;break;case 2:c=v.user}return o[1].hook(n,(function(n,o){var c=0===r,i=1===r;2==r&&n===e?t(e):c?t(n):i?t(n,o):console.warn("Unknown index: ".concat(r,", this means unknown hook."))}),c)}(e,n,t)},interrupt:function(e){var n=i(e);n?n[1].interrupt():console.warn("Doesn't exist the type named ".concat(e,". can't interrupt"))},createDispatch:w,createDispatches:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.map((function(e){return w(e)}))},dispatch:function(e){var n,t;return function(e,n,t){if("object"!==a(e))console.warn("Expected the object as object. Instead, received: ".concat(a(e)));else if(n.some((function(n){return!s.call(e,n)})))throw new Error("Expected the ".concat(t||"obj"," must own keys: ").concat(n.join(" ")))}(e,["type"],"The action"),f.hasType(e.type)?(t=e.type,n=i(t)?i(t)[2]:null):n=w(e.type),n(e.payload),n},reset:function(){return console.log("No effect, the 'reset' api has deprecated.")}})},e.decorateProcessor=function(e,n){if("function"!==a(e))throw new Error("Expected the processor as function. Instead, received:".concat(a(e),"."));if("array"!==a(n))throw new Error("Expected the processor as array. Instead, received:".concat(a(e),"."));var t=u(n);return function(n,r){return!!t.includes(null==n?void 0:n.type)&&(e(n,r),!0)}},Object.defineProperty(e,"__esModule",{value:!0})}));
